<!DOCTYPE html>
<html>
<head>
    <title>Gold Investment Chat</title>
    <script>
        async function sendPrompt() {
            const prompt = document.getElementById("prompt").value;
            const res = await fetch("/chat", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({prompt})
            });
            const data = await res.json();
            document.getElementById("response").innerText = data.response;

            if (data.gold_offer) {
                document.getElementById("gold-btn").style.display = "block";
            }
        }

        function showForm() {
            document.getElementById("form").style.display = "block";
        }

        async function submitTransaction() {
            const user_info = {
                name: document.getElementById("name").value,
                phone: document.getElementById("phone").value,
                email: document.getElementById("email").value,
                age: document.getElementById("age").value
            };
            const amount_inr = document.getElementById("amount").value;

            const res = await fetch("/buy-gold", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                    user_info,
                    investment: {amount_inr}
                })
            });
            const data = await res.json();
            document.getElementById("transaction").innerText =
                "âœ… " + data.message + " Bought " + data.details.investment.grams.toFixed(4) + " grams of gold.";
        }
    </script>
</head>
<body>
    <h1>Chat with AI</h1>
    <textarea id="prompt" rows="3" cols="40"></textarea><br>
    <button onclick="sendPrompt()">Send</button>

    <h3>Response:</h3>
    <div id="response"></div>

    <button id="gold-btn" style="display:none;" onclick="showForm()">Buy Gold</button>

    <div id="form" style="display:none;">
        <h3>Enter Your Details</h3>
        <input id="name" placeholder="Full Name"><br>
        <input id="phone" placeholder="Phone"><br>
        <input id="email" placeholder="Email"><br>
        <input id="age" placeholder="Age"><br>
        <input id="amount" placeholder="Amount in INR" oninput="document.getElementById('calc').innerText='Gold: ' + (this.value/10000).toFixed(4) + ' grams'"><br>
        <div id="calc"></div>
        <button onclick="submitTransaction()">Confirm Transaction</button>
    </div>

    <div id="transaction"></div>
</body>
</html>
